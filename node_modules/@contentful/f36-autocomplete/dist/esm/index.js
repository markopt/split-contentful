import n, { useState, useCallback } from 'react';
import { cx, css } from 'emotion';
import { useCombobox } from 'downshift';
import { mergeRefs } from '@contentful/f36-core';
import { IconButton } from '@contentful/f36-button';
import { TextInput } from '@contentful/f36-forms';
import { ChevronDownIcon, CloseIcon } from '@contentful/f36-icons';
import { Skeleton } from '@contentful/f36-skeleton';
import { Popover } from '@contentful/f36-popover';
import { Subheading, SectionHeading, Text } from '@contentful/f36-typography';
import { getStringMatch } from '@contentful/f36-utils';
import p from '@contentful/f36-tokens';

var Pe=Object.defineProperty,Me=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var W=(e,o,i)=>o in e?Pe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,d=(e,o)=>{for(var i in o||(o={}))q.call(o,i)&&W(e,i,o[i]);if(M)for(var i of M(o))z.call(o,i)&&W(e,i,o[i]);return e},g=(e,o)=>Me(e,Se(o));var j=(e,o)=>{var i={};for(var r in e)q.call(e,r)&&o.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&M)for(var r of M(e))o.indexOf(r)<0&&z.call(e,r)&&(i[r]=e[r]);return i};var S=e=>({autocomplete:css({position:"relative",width:"100%"}),combobox:css({position:"relative"}),inputField:css({paddingRight:p.spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:p.spacing2Xs,height:"38px"}),content:css({overflow:"auto",maxHeight:`${e}px`}),list:css({listStyle:"none",padding:`${p.spacingXs} 0`,margin:0}),groupTitle:css({padding:`${p.spacingXs} ${p.spacingM}`,lineHeight:p.lineHeightM}),noMatchesTitle:css({color:p.gray500,margin:`${p.spacingM} 0 ${p.spacingM} 0`}),item:css({display:"block",padding:`${p.spacingXs} ${p.spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:p.gray100},"&:active":{backgroundColor:p.gray200}}),disabled:css({opacity:.5,pointerEvents:"none"}),highlighted:css({backgroundColor:p.gray100}),hidden:css({display:"none"})});var C=e=>{let{items:o,elementStartIndex:i,highlightedIndex:r,getItemProps:I,renderItem:T,inputValue:b,listMaxHeight:H=180}=e,s=S(H);return n.createElement("ul",{className:s.list,"data-test-id":"cf-autocomplete-list"},o.map((u,E)=>{let c=i+E,L=I({item:u,index:c});return n.createElement(Text,g(d({},L),{as:"li",key:c,className:cx([s.item,r===c&&s.highlighted]),"data-test-id":`cf-autocomplete-list-item-${c}`}),T?T(u,b):typeof u=="string"?n.createElement(K,{item:u,inputValue:b}):u)}))};C.displayName="AutocompleteItems";function K({item:e,inputValue:o}){let{before:i,match:r,after:I}=getStringMatch(e,o);return n.createElement(n.Fragment,null,i,n.createElement("b",null,r),I)}K.displayName="HighlightedItem";function Re(e,o){let {id:i,className:r,clearAfterSelect:I=!1,closeAfterSelect:T=!0,defaultValue:b="",selectedItem:H,items:s,onInputValueChange:u,onSelectItem:E,onFocus:c,onBlur:L,renderItem:O,icon:Y=n.createElement(ChevronDownIcon,{variant:"muted"}),itemToString:Z=t=>t,isInvalid:ee,isDisabled:_,isRequired:te,isReadOnly:oe,showEmptyList:ne,noMatchesMessage:ie="No matches found",placeholder:se="Search",inputRef:re,toggleRef:pe,listRef:le,listWidth:ae="auto",listMaxHeight:me=180,isGrouped:x=!1,isLoading:v=!1,usePortal:ue=!1,testId:ce="cf-autocomplete"}=e,m=S(me),[h,de]=useState(b),y=useCallback(t=>{de(t),u==null||u(t);},[u]),ge=useCallback(t=>{let l=t.target.value;y(l);},[y]),he=A(x)?s.reduce((t,l)=>[...t,...l.options],[]):s,fe=A(x)?s.every(t=>t.options.length===0):s.length===0,{getComboboxProps:Ie,getInputProps:ye,getItemProps:$,getMenuProps:Te,getToggleButtonProps:be,highlightedIndex:D,isOpen:F,toggleMenu:k}=useCombobox({items:he,selectedItem:H,inputValue:h,itemToString:Z,onInputValueChange:({type:t,inputValue:l})=>{t!=="__input_change__"&&y(l);},onStateChange:({type:t,selectedItem:l})=>{switch(t){case useCombobox.stateChangeTypes.InputKeyDownEnter:case useCombobox.stateChangeTypes.ItemClick:l&&E(l),I&&y(""),T||k();break;}}}),U=ye(),w=j(U,["aria-labelledby","id"]),xe=Ie(),X=be(),P=Te(),N=0;return n.createElement("div",{"data-test-id":ce,className:cx(m.autocomplete,r),ref:o},n.createElement(Popover,{usePortal:ue,isOpen:F,isFullWidth:ae==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:P.id},n.createElement(Popover.Trigger,null,n.createElement("div",g(d({},xe),{className:m.combobox}),n.createElement(TextInput,g(d({className:m.inputField},w),{onFocus:t=>{c==null||c(t),F||k();},onBlur:L,id:i,isInvalid:ee,isDisabled:_,isRequired:te,isReadOnly:oe,ref:mergeRefs(w.ref,re),testId:"cf-autocomplete-input",placeholder:se,onChange:t=>{w.onChange(t),ge(t);}})),n.createElement(IconButton,g(d({},X),{ref:mergeRefs(X.ref,pe),"aria-label":h?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:h?n.createElement(CloseIcon,{variant:"muted"}):Y,onClick:()=>{h?y(""):k();},isDisabled:_,size:"small"})))),s.length>0||h.length>0||ne?n.createElement(Popover.Content,g(d({},P),{ref:mergeRefs(P.ref,le),className:m.content,testId:"cf-autocomplete-container"}),v&&[...Array(3)].map((t,l)=>n.createElement("div",{key:l,className:cx(m.item,m.disabled)},n.createElement(Be,null))),!v&&fe&&n.createElement("div",{className:m.item},n.createElement(Subheading,{className:m.noMatchesTitle},ie)),!v&&A(x)&&s.map((t,l)=>{if(t.options.length<1)return;let ve=n.createElement("div",{key:l},n.createElement(SectionHeading,{key:l,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},t.groupTitle),n.createElement(C,{items:t.options,highlightedIndex:D,getItemProps:$,renderItem:O,inputValue:h,elementStartIndex:N}));return N+=t.options.length,ve}),!v&&!A(x)&&s.length>0&&n.createElement(C,{items:s,elementStartIndex:N,highlightedIndex:D,getItemProps:$,renderItem:O,inputValue:h})):n.createElement("div",g(d({},P),{className:cx(m.hidden)}))))}var Be=()=>n.createElement(Skeleton.Container,{svgHeight:16},n.createElement(Skeleton.BodyText,{numberOfLines:1}));function A(e,o){return e}var Oe=n.forwardRef(Re);

export { Oe as Autocomplete };
//# sourceMappingURL=index.js.map