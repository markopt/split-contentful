'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var n = require('react');
var emotion = require('emotion');
var downshift = require('downshift');
var f36Core = require('@contentful/f36-core');
var f36Button = require('@contentful/f36-button');
var f36Forms = require('@contentful/f36-forms');
var f36Icons = require('@contentful/f36-icons');
var f36Skeleton = require('@contentful/f36-skeleton');
var f36Popover = require('@contentful/f36-popover');
var f36Typography = require('@contentful/f36-typography');
var f36Utils = require('@contentful/f36-utils');
var p = require('@contentful/f36-tokens');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var n__default = /*#__PURE__*/_interopDefaultLegacy(n);
var p__default = /*#__PURE__*/_interopDefaultLegacy(p);

var Pe=Object.defineProperty,Me=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var W=(e,o,i)=>o in e?Pe(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,d=(e,o)=>{for(var i in o||(o={}))q.call(o,i)&&W(e,i,o[i]);if(M)for(var i of M(o))z.call(o,i)&&W(e,i,o[i]);return e},g=(e,o)=>Me(e,Se(o));var j=(e,o)=>{var i={};for(var r in e)q.call(e,r)&&o.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&M)for(var r of M(e))o.indexOf(r)<0&&z.call(e,r)&&(i[r]=e[r]);return i};var S=e=>({autocomplete:emotion.css({position:"relative",width:"100%"}),combobox:emotion.css({position:"relative"}),inputField:emotion.css({paddingRight:p__default["default"].spacingXl,textOverflow:"ellipsis",whiteSpace:"nowrap"}),toggleButton:emotion.css({position:"absolute",top:"1px",right:"1px",zIndex:1,padding:p__default["default"].spacing2Xs,height:"38px"}),content:emotion.css({overflow:"auto",maxHeight:`${e}px`}),list:emotion.css({listStyle:"none",padding:`${p__default["default"].spacingXs} 0`,margin:0}),groupTitle:emotion.css({padding:`${p__default["default"].spacingXs} ${p__default["default"].spacingM}`,lineHeight:p__default["default"].lineHeightM}),noMatchesTitle:emotion.css({color:p__default["default"].gray500,margin:`${p__default["default"].spacingM} 0 ${p__default["default"].spacingM} 0`}),item:emotion.css({display:"block",padding:`${p__default["default"].spacingXs} ${p__default["default"].spacingM}`,wordBreak:"break-word",whiteSpace:"break-spaces",cursor:"pointer",hyphens:"auto","&:focus, &:hover":{backgroundColor:p__default["default"].gray100},"&:active":{backgroundColor:p__default["default"].gray200}}),disabled:emotion.css({opacity:.5,pointerEvents:"none"}),highlighted:emotion.css({backgroundColor:p__default["default"].gray100}),hidden:emotion.css({display:"none"})});var C=e=>{let{items:o,elementStartIndex:i,highlightedIndex:r,getItemProps:I,renderItem:T,inputValue:b,listMaxHeight:H=180}=e,s=S(H);return n__default["default"].createElement("ul",{className:s.list,"data-test-id":"cf-autocomplete-list"},o.map((u,E)=>{let c=i+E,L=I({item:u,index:c});return n__default["default"].createElement(f36Typography.Text,g(d({},L),{as:"li",key:c,className:emotion.cx([s.item,r===c&&s.highlighted]),"data-test-id":`cf-autocomplete-list-item-${c}`}),T?T(u,b):typeof u=="string"?n__default["default"].createElement(K,{item:u,inputValue:b}):u)}))};C.displayName="AutocompleteItems";function K({item:e,inputValue:o}){let{before:i,match:r,after:I}=f36Utils.getStringMatch(e,o);return n__default["default"].createElement(n__default["default"].Fragment,null,i,n__default["default"].createElement("b",null,r),I)}K.displayName="HighlightedItem";function Re(e,o){let {id:i,className:r,clearAfterSelect:I=!1,closeAfterSelect:T=!0,defaultValue:b="",selectedItem:H,items:s,onInputValueChange:u,onSelectItem:E,onFocus:c,onBlur:L,renderItem:O,icon:Y=n__default["default"].createElement(f36Icons.ChevronDownIcon,{variant:"muted"}),itemToString:Z=t=>t,isInvalid:ee,isDisabled:_,isRequired:te,isReadOnly:oe,showEmptyList:ne,noMatchesMessage:ie="No matches found",placeholder:se="Search",inputRef:re,toggleRef:pe,listRef:le,listWidth:ae="auto",listMaxHeight:me=180,isGrouped:x=!1,isLoading:v=!1,usePortal:ue=!1,testId:ce="cf-autocomplete"}=e,m=S(me),[h,de]=n.useState(b),y=n.useCallback(t=>{de(t),u==null||u(t);},[u]),ge=n.useCallback(t=>{let l=t.target.value;y(l);},[y]),he=A(x)?s.reduce((t,l)=>[...t,...l.options],[]):s,fe=A(x)?s.every(t=>t.options.length===0):s.length===0,{getComboboxProps:Ie,getInputProps:ye,getItemProps:$,getMenuProps:Te,getToggleButtonProps:be,highlightedIndex:D,isOpen:F,toggleMenu:k}=downshift.useCombobox({items:he,selectedItem:H,inputValue:h,itemToString:Z,onInputValueChange:({type:t,inputValue:l})=>{t!=="__input_change__"&&y(l);},onStateChange:({type:t,selectedItem:l})=>{switch(t){case downshift.useCombobox.stateChangeTypes.InputKeyDownEnter:case downshift.useCombobox.stateChangeTypes.ItemClick:l&&E(l),I&&y(""),T||k();break;}}}),U=ye(),w=j(U,["aria-labelledby","id"]),xe=Ie(),X=be(),P=Te(),N=0;return n__default["default"].createElement("div",{"data-test-id":ce,className:emotion.cx(m.autocomplete,r),ref:o},n__default["default"].createElement(f36Popover.Popover,{usePortal:ue,isOpen:F,isFullWidth:ae==="full",renderOnlyWhenOpen:!1,autoFocus:!1,id:P.id},n__default["default"].createElement(f36Popover.Popover.Trigger,null,n__default["default"].createElement("div",g(d({},xe),{className:m.combobox}),n__default["default"].createElement(f36Forms.TextInput,g(d({className:m.inputField},w),{onFocus:t=>{c==null||c(t),F||k();},onBlur:L,id:i,isInvalid:ee,isDisabled:_,isRequired:te,isReadOnly:oe,ref:f36Core.mergeRefs(w.ref,re),testId:"cf-autocomplete-input",placeholder:se,onChange:t=>{w.onChange(t),ge(t);}})),n__default["default"].createElement(f36Button.IconButton,g(d({},X),{ref:f36Core.mergeRefs(X.ref,pe),"aria-label":h?"Clear":"Show list",className:m.toggleButton,variant:"transparent",icon:h?n__default["default"].createElement(f36Icons.CloseIcon,{variant:"muted"}):Y,onClick:()=>{h?y(""):k();},isDisabled:_,size:"small"})))),s.length>0||h.length>0||ne?n__default["default"].createElement(f36Popover.Popover.Content,g(d({},P),{ref:f36Core.mergeRefs(P.ref,le),className:m.content,testId:"cf-autocomplete-container"}),v&&[...Array(3)].map((t,l)=>n__default["default"].createElement("div",{key:l,className:emotion.cx(m.item,m.disabled)},n__default["default"].createElement(Be,null))),!v&&fe&&n__default["default"].createElement("div",{className:m.item},n__default["default"].createElement(f36Typography.Subheading,{className:m.noMatchesTitle},ie)),!v&&A(x)&&s.map((t,l)=>{if(t.options.length<1)return;let ve=n__default["default"].createElement("div",{key:l},n__default["default"].createElement(f36Typography.SectionHeading,{key:l,"data-test-id":"cf-autocomplete-grouptitle",marginBottom:"none",className:m.groupTitle},t.groupTitle),n__default["default"].createElement(C,{items:t.options,highlightedIndex:D,getItemProps:$,renderItem:O,inputValue:h,elementStartIndex:N}));return N+=t.options.length,ve}),!v&&!A(x)&&s.length>0&&n__default["default"].createElement(C,{items:s,elementStartIndex:N,highlightedIndex:D,getItemProps:$,renderItem:O,inputValue:h})):n__default["default"].createElement("div",g(d({},P),{className:emotion.cx(m.hidden)}))))}var Be=()=>n__default["default"].createElement(f36Skeleton.Skeleton.Container,{svgHeight:16},n__default["default"].createElement(f36Skeleton.Skeleton.BodyText,{numberOfLines:1}));function A(e,o){return e}var Oe=n__default["default"].forwardRef(Re);

exports.Autocomplete = Oe;
//# sourceMappingURL=index.js.map